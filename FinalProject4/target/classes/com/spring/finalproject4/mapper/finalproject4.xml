<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="finalproject4">

	<resultMap type="HashMap" id="resShowInfo">
		<result property="prod_id"			column="prod_id"		javaType="String"/>
		<result property="prod_img"			column="prod_img"		javaType="String"/>
		<result property="prod_title"		column="prod_title"		javaType="String"/>
		<result property="info_grade"		column="info_grade"		javaType="String"/>
		<result property="info_run_time"	column="info_run_time"	javaType="String"/>
		<result property="map_name"			column="map_name"		javaType="String"/>
	</resultMap>
	<select id="getShowRsvInfo" resultMap="resShowInfo" parameterType="String">
		select prod_id, prod_img, prod_title, info_grade, info_run_time, map_name 
		from view_rev_showInfo
		where prod_id = #{showNum}
	</select>
	
	<resultMap type="HashMap" id="resShowTime">
		<result property="date_showday"		column="date_showday"	javaType="String"/>
		<result property="date_showtime"	column="date_showtime"	javaType="String"/>
	</resultMap>
	<select id="getShowTime" resultMap="resShowTime" parameterType="String">
		select prod_id, to_char(date_showday, 'yy/mm/dd') || ' ' || to_char(date_showday, 'day') as date_showday, date_showtime
		from yes_show_date
		where prod_id = #{showNum}
		order by date_showday, date_showtime
	</select>
	
	<select id="getShowDay" resultType="String" parameterType="String">
		select distinct to_char(date_showday, 'yy/mm/dd') || ' ' || to_char(date_showday, 'day') as date_showday
		from yes_show_date
		where prod_id = #{showNum}
		order by date_showday
	</select>
	
	<resultMap type="HashMap" id="seatStatus">
		<result property="date_id"			column="date_id"		javaType="String"/>
		<result property="prod_id"			column="prod_id"		javaType="String"/>
		<result property="seattype_id"		column="seattype_id"	javaType="String"/>
		<result property="seat_type"		column="seat_type"		javaType="String"/>
		<result property="seat_name"		column="seat_name"		javaType="String"/>
		<result property="seat_price"		column="seat_price"		javaType="String"/>
		<result property="seat_status"		column="seat_status"	javaType="String"/>
		<result property="date_id"			column="date_id"		javaType="String"/>
		<result property="seat_color"		column="seat_color"		javaType="String"/>
	</resultMap>
	<select id="getSeatStatus" parameterType="String" resultMap="seatStatus">
		select date_id, prod_id, seattype_id, seat_type, seat_name, seat_price, seat_status, date_id, seat_color
		from view_seat_info
		where prod_id = #{showNum}
	</select>
	
	<resultMap type="HashMap" id="seatType">
		<result property="seat_type"		column="seat_type"	javaType="String"/>
		<result property="seat_price"		column="seat_price"	javaType="String"/>
		<result property="seat_color"		column="seat_color"	javaType="String"/>
	</resultMap>
	<select id="getSeatType" resultMap="seatType" parameterType="String">
		select seat_type, seat_price, seat_color
		from yes_seat_type
		where prod_id = #{showNum}
	</select>
	
	<select id="getDateId" parameterType="HashMap" resultType="String">
		select date_id
		from yes_show_date
		where prod_id = #{showNum} and to_char(date_showday, 'yy/mm/dd') || ' ' || to_char(date_showday, 'day') = #{showDay} and date_showtime = #{showRound}
	</select>
	
	<!-- ===== BOARD(공지사항, FAQ, QNA, 리뷰 부분 ===== -->
	<!-- FAQ 리스트(검색어 있음) -->
	<select id="faqList" parameterType="HashMap" resultType="com.spring.model.FaqVO">
		select faq_id, fk_userid, subject, content, regDate, status, faq_cate_name
		from 
		(
		select faq_id, fk_userid, C.faq_cate_name, fk_category, subject, content, regDate, status
		from yes_faq F join yes_faq_cate C
		on F.fk_category = C.faq_cate_code
		) T
		where 1=1 
		<if test='category != ""'>
		and fk_category = #{category} 
		</if>
		<if test='searchWord != ""'>
		and subject like '%' || #{searchWord} || '%'
		</if>
	</select>
	
	<!-- 총 공지글 개수 -->
	<select id="getTotalNoticeCount" parameterType="HashMap" resultType="int">
		select count(*) 
		from yes_notice
		where 1=1 
		<if test='searchWord != ""'>
		and subject like '%' || #{searchWord} || '%'
		</if>
	</select>
	
	<!-- 페이징처리한 공지글 리스트 -->
	<select id="noticeListWithPaging" parameterType="HashMap" resultType="com.spring.model.NoticeVO">
		select notice_id, fk_userid,no_cate_name,category,ticketopenday,subject,readCount,regDate,status,fileName,orgFilename,fileSize
		    from
		    (
		        select row_number() over(order by notice_id desc) AS rno, notice_id,fk_userid,no_cate_name,category,ticketopenday,subject,readCount,regDate,status,fileName,orgFilename,fileSize
		        from
		        (
			        select notice_id,fk_userid,no_cate_name,category,ticketopenday,subject,readCount,regDate,status,fileName,orgFilename,fileSize
			        from yes_notice N join yes_notice_cate C
			        on N.category = C.no_cate_code
		        )
		        where status = 1
		        <if test='searchWord != ""'>
		        and subject like '%' || #{searchWord} || '%'
		        </if>
		    )V
		where rno between #{startRno} and #{endRno}
	</select>
	
	
	<!-- 공지사항 글 1개 보기 페이지로 이동(조회수 증가 없음) -->
	<select id="getView" parameterType="HashMap" resultType="com.spring.model.NoticeVO">
		select previousseq, previoussubject
		       , notice_id,fk_userid,category, ticketopenday, subject,readCount
		       , regDate
		       , fileName,orgFilename,fileSize
			   , nextseq, nextsubject
				from
				    (
		                select lag(notice_id, 1) over(order by notice_id desc) as previousseq
				       , lag(subject, 1) over(order by notice_id desc) as previoussubject
				       
				       , notice_id, fk_userid, category, subject, readCount
		               , nvl(ticketopenday, ' ') as ticketopenday
				       , to_char(regDate, 'yyyy-mm-dd') as regDate
				       , status, fileName, orgFilename, fileSize
				       
				       , lead(notice_id, 1) over(order by notice_id desc) as nextseq
				       , lead(subject, 1) over(order by notice_id desc) as nextsubject
		                from yes_notice
		                where status = 1
				    ) V
		where notice_id = #{seq}
	</select>
	
	
	<!-- ===== BOARD(공지사항, FAQ, QNA, 리뷰 부분 ===== -->

</mapper>